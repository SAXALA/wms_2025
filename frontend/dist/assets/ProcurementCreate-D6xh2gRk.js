import{a as V}from"./api-CBBxTYRf.js";import{_ as E,r as v,a as $,c as A,o as M,b as k,d as i,e as n,w as s,f as a,g as q,h as r,t as g,i as c,F as j,j as K,E as p}from"./index-DBwGIS2Y.js";const T={class:"page-header flex-between"},z={class:"card-section"},G={class:"card-section"},H={key:1,class:"total-line"},J={class:"card-section"},O={__name:"ProcurementCreate",setup(Q){const _=v([]),d=v(null),f=v(!1),t=$({quantity:1,remark:"",items:[]}),w=A(()=>t.items.reduce((o,e)=>o+Number(e.price??0)*Number(e.quantity??0),0));M(async()=>{_.value=await V.listProducts()});const C=o=>{o&&(t.quantity=1)},P=()=>{if(!d.value){p.warning("请选择商品");return}const o=_.value.find(m=>m.id===d.value);if(!o)return;const e=t.items.find(m=>m.productId===o.id);e?e.quantity+=t.quantity:t.items.push({productId:o.id,sku:o.sku,name:o.name,unit:o.unit,price:o.price,quantity:t.quantity}),p.success("已加入清单")},h=o=>{t.items.splice(o,1)},N=async()=>{if(!t.items.length){p.error("请至少选择一件商品");return}f.value=!0;try{await V.submitPurchase({remark:t.remark,items:t.items,totalAmount:w.value}),p.success("采购申请提交成功"),t.items=[],t.remark="",d.value=null}finally{f.value=!1}},y=o=>Number(o??0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return(o,e)=>{const m=a("Promotion"),x=a("el-icon"),b=a("el-button"),S=a("el-option"),B=a("el-select"),F=a("el-input-number"),I=a("Plus"),u=a("el-table-column"),L=a("el-table"),U=a("el-empty"),D=a("el-input");return c(),k("div",null,[i("div",T,[e[4]||(e[4]=i("h2",null,"采购申请创建",-1)),n(b,{type:"primary",loading:f.value,onClick:N},{default:s(()=>[n(x,null,{default:s(()=>[n(m)]),_:1}),e[3]||(e[3]=r(" 提交申请 ",-1))]),_:1},8,["loading"])]),i("section",z,[e[6]||(e[6]=i("h3",null,"商品选择",-1)),n(B,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),filterable:"",placeholder:"请选择商品",onChange:C,style:{width:"380px"}},{default:s(()=>[(c(!0),k(j,null,K(_.value,l=>(c(),q(S,{key:l.id,label:`${l.name} (${l.sku})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(F,{modelValue:t.quantity,"onUpdate:modelValue":e[1]||(e[1]=l=>t.quantity=l),min:1,step:10,placeholder:"数量",style:{"margin-left":"16px"}},null,8,["modelValue"]),n(b,{type:"primary",link:"",style:{"margin-left":"12px"},onClick:P},{default:s(()=>[n(x,null,{default:s(()=>[n(I)]),_:1}),e[5]||(e[5]=r(" 加入清单 ",-1))]),_:1})]),i("section",G,[e[9]||(e[9]=i("h3",null,"申请明细",-1)),n(L,{data:t.items,border:""},{default:s(()=>[n(u,{prop:"sku",label:"SKU",width:"120"}),n(u,{prop:"name",label:"商品名称"}),n(u,{prop:"unit",label:"单位",width:"80"}),n(u,{prop:"quantity",label:"数量",width:"100"}),n(u,{label:"单价",width:"120"},{default:s(({row:l})=>[r(g(y(l.price)),1)]),_:1}),n(u,{label:"金额",width:"140"},{default:s(({row:l})=>[r(g(y(l.price*l.quantity)),1)]),_:1}),n(u,{label:"操作",width:"100"},{default:s(({$index:l})=>[n(b,{type:"danger",link:"",onClick:R=>h(l)},{default:s(()=>[...e[7]||(e[7]=[r("移除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t.items.length?(c(),k("div",H,[e[8]||(e[8]=r(" 合计金额：",-1)),i("span",null,g(y(w.value)),1)])):(c(),q(U,{key:0,description:"请选择商品加入清单"}))]),i("section",J,[e[10]||(e[10]=i("h3",null,"备注信息",-1)),n(D,{modelValue:t.remark,"onUpdate:modelValue":e[2]||(e[2]=l=>t.remark=l),type:"textarea",rows:3,placeholder:"填写采购理由或其他说明"},null,8,["modelValue"])])])}}},Y=E(O,[["__scopeId","data-v-d797dd95"]]);export{Y as default};
