import{a as x}from"./api-CBBxTYRf.js";import{_ as F,r as L,a as M,o as P,c as j,b as f,d as p,e as l,w as n,f as d,g as y,l as z,i as u,h as r,F as K,j as R,t as $,E as V}from"./index-DBwGIS2Y.js";const A={class:"page-header flex-between"},G={class:"card-section"},H={class:"flex-between",style:{"margin-bottom":"16px"}},J={class:"location-cell"},Q={key:1,class:"text-muted"},W={__name:"OutboundCreate",setup(X){const m=L(!1),v=L([]),o=M({orderType:"",customer:"",expectedDate:"",lines:[]});P(async()=>{v.value=await x.listLocations({includeInactive:!1})});const g=j(()=>v.value.filter(s=>s.active)),I=s=>g.value.find(t=>String(t.id)===String(s)),U=(s,t)=>{const c=I(t);if(!c){s.locationId=null,s.locationLabel="";return}s.locationId=c.id,s.locationLabel=c.displayLabel},C=()=>{o.lines.push({productId:null,sku:"",name:"",quantity:1,batch:"",locationId:null,locationLabel:""})},D=s=>{o.lines.splice(s,1)},S=async()=>{if(!o.lines.length){V.error("请至少添加一行物料");return}if(o.lines.find(t=>!t.productId||t.quantity<=0)){V.error("请填写有效的商品ID与数量");return}m.value=!0;try{await x.submitOutbound({...o}),V.success("出库申请已提交"),o.orderType="",o.customer="",o.expectedDate="",o.lines=[]}finally{m.value=!1}};return(s,t)=>{const c=d("Sell"),h=d("el-icon"),_=d("el-button"),b=d("el-input"),w=d("el-date-picker"),k=d("el-input-number"),i=d("el-table-column"),T=d("el-option"),q=d("el-select"),B=d("el-tag"),N=d("el-table"),E=d("el-empty"),O=d("Plus");return u(),f("div",null,[p("div",A,[t[4]||(t[4]=p("h2",null,"出库申请创建",-1)),l(_,{type:"primary",loading:m.value,onClick:S},{default:n(()=>[l(h,null,{default:n(()=>[l(c)]),_:1}),t[3]||(t[3]=r(" 提交出库单 ",-1))]),_:1},8,["loading"])]),p("section",G,[p("div",H,[l(b,{modelValue:o.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>o.orderType=e),placeholder:"出库类型 (销售/调拨)",style:{width:"220px"}},null,8,["modelValue"]),l(b,{modelValue:o.customer,"onUpdate:modelValue":t[1]||(t[1]=e=>o.customer=e),placeholder:"目的客户/仓库",style:{width:"220px"}},null,8,["modelValue"]),l(w,{modelValue:o.expectedDate,"onUpdate:modelValue":t[2]||(t[2]=e=>o.expectedDate=e),type:"date",placeholder:"计划出库日期"},null,8,["modelValue"])]),l(N,{data:o.lines,border:""},{default:n(()=>[l(i,{label:"商品ID",width:"120"},{default:n(({row:e})=>[l(k,{modelValue:e.productId,"onUpdate:modelValue":a=>e.productId=a,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(i,{prop:"sku",label:"SKU",width:"120"}),l(i,{prop:"name",label:"物料名称"}),l(i,{label:"数量",width:"120"},{default:n(({row:e})=>[l(k,{modelValue:e.quantity,"onUpdate:modelValue":a=>e.quantity=a,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(i,{label:"库位",width:"220"},{default:n(({row:e})=>[p("div",J,[l(q,{modelValue:e.locationId,"onUpdate:modelValue":a=>e.locationId=a,placeholder:"选择库位",filterable:"",clearable:"",onChange:a=>U(e,a)},{default:n(()=>[(u(!0),f(K,null,R(g.value,a=>(u(),y(T,{key:a.id,label:a.displayLabel,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"]),e.locationLabel?(u(),y(B,{key:0,size:"small",type:"info"},{default:n(()=>[r($(e.locationLabel),1)]),_:2},1024)):(u(),f("span",Q,"未指定"))])]),_:1}),l(i,{label:"批次",width:"160"},{default:n(({row:e})=>[l(b,{modelValue:e.batch,"onUpdate:modelValue":a=>e.batch=a,placeholder:"批次号"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(i,{label:"操作",width:"100"},{default:n(({$index:e})=>[l(_,{link:"",type:"danger",onClick:a=>D(e)},{default:n(()=>[...t[5]||(t[5]=[r("移除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),o.lines.length?z("",!0):(u(),y(E,{key:0,description:"请添加出库物料"})),l(_,{style:{"margin-top":"12px"},onClick:C},{default:n(()=>[l(h,null,{default:n(()=>[l(O)]),_:1}),t[6]||(t[6]=r(" 添加物料 ",-1))]),_:1})])])}}},ee=F(W,[["__scopeId","data-v-4ec7dca7"]]);export{ee as default};
