import{a as v}from"./api-CBBxTYRf.js";import{_ as O,r as _,a as M,c as h,o as Q,k as W,b as X,d as g,e as t,f as i,w as a,g as N,l as S,i as C,h as d,t as L,p as Y,E as p}from"./index-DBwGIS2Y.js";const Z={class:"page-header flex-between"},ee={class:"header-actions"},te={class:"card-section"},le={__name:"LocationManagement",setup(ae){const w=_(!1),k=_(!1),x=_([]),u=_(!1),f=_(null),s=M({keyword:"",includeInactive:!1}),o=M({code:"",name:"",description:"",active:!0}),T=h(()=>f.value?"编辑库位":"新增库位"),y=async()=>{w.value=!0;try{x.value=await v.listLocations({includeInactive:!0})}finally{w.value=!1}};Q(()=>{y()});const I=h(()=>{const n=s.keyword.trim().toLowerCase();return x.value.filter(e=>s.includeInactive?!0:e.active).filter(e=>n?[e.code,e.name].some(r=>r==null?void 0:r.toLowerCase().includes(n)):!0)}),z=()=>{f.value=null,U(),u.value=!0},A=n=>{f.value=n.id,o.code=n.code,o.name=n.name,o.description=n.description??"",o.active=n.active,u.value=!0},U=()=>{o.code="",o.name="",o.description="",o.active=!0},D=async()=>{var n;if(!o.code.trim()){p.warning("请输入库位编码");return}if(!o.name.trim()){p.warning("请输入库位名称");return}k.value=!0;try{const e={code:o.code.trim(),name:o.name.trim(),description:((n=o.description)==null?void 0:n.trim())||"",active:o.active};f.value?(await v.updateLocation(f.value,e),p.success("库位已更新")):(await v.createLocation(e),p.success("库位已创建")),u.value=!1,await y()}finally{k.value=!1}},F=async n=>{try{await Y.confirm(`确认${n.active?"停用":"启用"}库位「${n.code}」？`,"提示",{type:"warning"})}catch{return}await v.toggleLocationStatus(n.id,!n.active),p.success(`库位已${n.active?"停用":"启用"}`),await y()},P=async n=>{await v.deleteLocation(n.id),p.success("库位已删除"),await y()};return W(()=>s.includeInactive,n=>{!n&&!x.value.some(e=>e.active)&&(s.keyword="")}),(n,e)=>{const r=i("el-switch"),R=i("Search"),$=i("el-icon"),b=i("el-input"),j=i("Plus"),c=i("el-button"),m=i("el-table-column"),B=i("el-tag"),q=i("el-popconfirm"),G=i("el-table"),H=i("el-empty"),V=i("el-form-item"),J=i("el-form"),K=i("el-dialog");return C(),X("div",null,[g("div",Z,[e[9]||(e[9]=g("h2",null,"库位管理",-1)),g("div",ee,[t(r,{modelValue:s.includeInactive,"onUpdate:modelValue":e[0]||(e[0]=l=>s.includeInactive=l),"active-text":"显示停用库位"},null,8,["modelValue"]),t(b,{modelValue:s.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>s.keyword=l),placeholder:"搜索编码 / 名称",clearable:"",class:"keyword-input"},{prefix:a(()=>[t($,null,{default:a(()=>[t(R)]),_:1})]),_:1},8,["modelValue"]),t(c,{type:"primary",onClick:z},{default:a(()=>[t($,null,{default:a(()=>[t(j)]),_:1}),e[8]||(e[8]=d(" 新增库位 ",-1))]),_:1})])]),g("section",te,[t(G,{data:I.value,stripe:"",border:"",loading:w.value},{default:a(()=>[t(m,{prop:"code",label:"编码",width:"140"}),t(m,{label:"名称","min-width":"200"},{default:a(({row:l})=>[g("span",null,L(l.name),1),l.active?S("",!0):(C(),N(B,{key:0,size:"small",type:"warning",class:"inline-tag"},{default:a(()=>[...e[10]||(e[10]=[d("已停用",-1)])]),_:1}))]),_:1}),t(m,{prop:"description",label:"描述","min-width":"220","show-overflow-tooltip":""}),t(m,{label:"状态",width:"120"},{default:a(({row:l})=>[t(B,{type:l.active?"success":"info"},{default:a(()=>[d(L(l.active?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"updatedAt",label:"最近更新",width:"180"}),t(m,{label:"操作",width:"220",fixed:"right"},{default:a(({row:l})=>[t(c,{link:"",type:"primary",onClick:E=>A(l)},{default:a(()=>[...e[11]||(e[11]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(c,{link:"",type:"warning",onClick:E=>F(l)},{default:a(()=>[d(L(l.active?"停用":"启用"),1)]),_:2},1032,["onClick"]),t(q,{title:"确认删除该库位？","confirm-button-text":"删除","cancel-button-text":"取消","confirm-button-type":"danger",onConfirm:E=>P(l)},{reference:a(()=>[t(c,{link:"",type:"danger"},{default:a(()=>[...e[12]||(e[12]=[d("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data","loading"]),!w.value&&!I.value.length?(C(),N(H,{key:0,description:"暂无库位"})):S("",!0)]),t(K,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=l=>u.value=l),title:T.value,width:"480px",onClosed:U},{footer:a(()=>[t(c,{onClick:e[6]||(e[6]=l=>u.value=!1)},{default:a(()=>[...e[13]||(e[13]=[d("取消",-1)])]),_:1}),t(c,{type:"primary",loading:k.value,onClick:D},{default:a(()=>[...e[14]||(e[14]=[d("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(J,{"label-width":"88px"},{default:a(()=>[t(V,{label:"编码"},{default:a(()=>[t(b,{modelValue:o.code,"onUpdate:modelValue":e[2]||(e[2]=l=>o.code=l),maxlength:"64",placeholder:"如 A01-01"},null,8,["modelValue"])]),_:1}),t(V,{label:"名称"},{default:a(()=>[t(b,{modelValue:o.name,"onUpdate:modelValue":e[3]||(e[3]=l=>o.name=l),maxlength:"128",placeholder:"库位名称"},null,8,["modelValue"])]),_:1}),t(V,{label:"描述"},{default:a(()=>[t(b,{modelValue:o.description,"onUpdate:modelValue":e[4]||(e[4]=l=>o.description=l),type:"textarea",maxlength:"256",autosize:{minRows:2,maxRows:4}},null,8,["modelValue"])]),_:1}),t(V,{label:"状态"},{default:a(()=>[t(r,{modelValue:o.active,"onUpdate:modelValue":e[5]||(e[5]=l=>o.active=l),"active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}},ie=O(le,[["__scopeId","data-v-f85b0344"]]);export{ie as default};
